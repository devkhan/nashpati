// This file has been autogenerated from a class added in the UI designer.

using System;

using Foundation;
using AppKit;
using AVFoundation;

namespace nashpati.skin
{
	public partial class PlayerViewController : BaseViewController
	{
		public static AVPlayer player;


		public PlayerViewController (IntPtr handle) : base (handle)
		{
		}

		public override void ViewDidLoad()
		{
			base.ViewDidLoad();

			player = new AVPlayer(
				new AVPlayerItem(
					AVAsset.FromUrl(
						NSUrl.FromFilename(
							Environment.GetEnvironmentVariable(
								"NASHPATI_SAMPLE_VIDEO_FILE") ?? "/temp/sample.mp4"))));

			PlayerView.Player = player;
			if (!base.prefs.Paused) { PlayerView.Player.Play(); }

			PlayerControlsContainerView.Layer = new CoreAnimation.CALayer();
			PlayerControlsContainerView.Layer.ZPosition = 1;
			PlayerView.AddSubview(PlayerControlsContainerView);

		}

		public async override void PreferencesChanged(Preferences preferences)
		{
			base.PreferencesChanged(preferences);
			if (prefs.Paused)
			{
				player.Pause();
			}
			else
			{
				player.Play();
			}
		}

	}
}
